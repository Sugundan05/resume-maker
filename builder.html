<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resume Builder</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="logo">Resume<span>Pro</span></div>
    <ul class="nav-links">
        <li><a href="index.html" class="active">Home</a></li>
      <li><a href="builder.html">Build Resume</a></li>
      <li><a href="template.html">Templates</a></li>
      <li><a href="ai-builder.html">About</a></li>
      <li><a href="ats-checker.html">ATS Checker</a></li>
    </ul>
  </nav>

  <!-- Page Header -->
  <header class="page-header">
    <h1>Edit Your Resume</h1>
    <p>Fill in your details and customize your resume. Data is auto-saved!</p>
  </header>

  <main class="builder-container">
    <!-- Form Section -->
    <section class="builder-form">
      <h2>Personal Information</h2>

      <label>Profile Image</label>
      <input type="file" id="photo" accept="image/*">

      <label>Full Name</label>
      <input type="text" id="name">

      <label>Email</label>
      <input type="email" id="email">

      <label>Phone</label>
      <input type="text" id="phone">

      <label>Location</label>
      <input type="text" id="location">

      <label>LinkedIn</label>
      <input type="text" id="linkedin">

      <label>GitHub</label>
      <input type="text" id="github">

      <h2>Resume Details</h2>

      <label>Summary</label>
      <textarea id="summary"></textarea>

      <label>Skills</label>
      <textarea id="skills"></textarea>

      <label>Languages</label>
      <textarea id="languages" placeholder="English, Tamil, Hindi..."></textarea>

      <label>Experience</label>
      <textarea id="experience"></textarea>

      <label>Education</label>
      <textarea id="education"></textarea>

      <label>Certifications & Awards</label>
      <textarea id="certifications"></textarea>

      <h2>Customize</h2>
      <label>Heading Font</label>
      <select id="headingFont">
        <option value="Arial">Arial</option>
        <option value="Georgia">Georgia</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Verdana">Verdana</option>
      </select>

      <label>Body Font</label>
      <select id="bodyFont">
        <option value="Arial">Arial</option>
        <option value="Georgia">Georgia</option>
        <option value="Calibri">Calibri</option>
        <option value="Verdana">Verdana</option>
      </select>

      <label>Font Size</label>
      <input type="number" id="fontSize" value="14">

      <label>Line Spacing</label>
      <input type="number" id="lineSpacing" value="1.5" step="0.1">

      <label>Template Color</label>
      <input type="color" id="templateColor" value="#1a73e8">

      <h2>Actions</h2>
      <button onclick="downloadPDF()" class="btn">Download PDF</button>
      <button onclick="downloadDOCX()" class="btn">Download DOCX</button>
      <button onclick="downloadTXT()" class="btn">Download TXT</button>
      <button onclick="resetResume()" class="btn reset">Reset Resume</button>
    </section>

    <!-- Preview Section -->
    <section class="resume-preview">
      <h2>Live Preview</h2>
      <div id="resume-template" class="resume-box"></div>
    </section>
  </main>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pizzip/3.1.1/pizzip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.36.0/docxtemplater.js"></script>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const templateID = urlParams.get('template') || "1";
    const resumeBox = document.getElementById("resume-template");

    // Templates
    const templates = {
      1: `
        <div class="template-one">
          <img id="prev-photo" class="profile-pic" src="">
          <h1 id="prev-name">Your Name</h1>
          <p id="prev-location"></p>
          <p><b>Email:</b> <span id="prev-email"></span> | <b>Phone:</b> <span id="prev-phone"></span></p>
          <p><b>LinkedIn:</b> <span id="prev-linkedin"></span> | <b>GitHub:</b> <span id="prev-github"></span></p>
          <h2>Summary</h2><p id="prev-summary"></p>
          <h2>Skills</h2><p id="prev-skills"></p>
          <h2>Languages</h2><p id="prev-languages"></p>
          <h2>Experience</h2><p id="prev-experience"></p>
          <h2>Education</h2><p id="prev-education"></p>
          <h2>Certifications & Awards</h2><p id="prev-certifications"></p>
        </div>
      `
    };

    resumeBox.innerHTML = templates[templateID];

    // Live update mapping
    const fields = ["name","email","phone","location","linkedin","github","summary","skills","languages","experience","education","certifications"];
    fields.forEach(field => {
      const el = document.getElementById(field);
      el.addEventListener("input", () => {
        document.getElementById("prev-" + field).innerText = el.value;
        saveData();
      });
    });

    // Image upload
    document.getElementById("photo").addEventListener("change", function(event) {
      const reader = new FileReader();
      reader.onload = function() {
        document.getElementById("prev-photo").src = reader.result;
        saveData();
      }
      reader.readAsDataURL(event.target.files[0]);
    });

    // Customization
    document.getElementById("headingFont").addEventListener("change", e => {
      resumeBox.querySelectorAll("h1,h2,h3").forEach(h => h.style.fontFamily = e.target.value);
      saveData();
    });
    document.getElementById("bodyFont").addEventListener("change", e => {
      resumeBox.style.fontFamily = e.target.value;
      saveData();
    });
    document.getElementById("fontSize").addEventListener("input", e => {
      resumeBox.style.fontSize = e.target.value + "px";
      saveData();
    });
    document.getElementById("lineSpacing").addEventListener("input", e => {
      resumeBox.style.lineHeight = e.target.value;
      saveData();
    });
    document.getElementById("templateColor").addEventListener("input", e => {
      resumeBox.querySelectorAll("h1,h2,h3").forEach(h => h.style.color = e.target.value);
      saveData();
    });

    // Save to LocalStorage
    function saveData() {
      localStorage.setItem("resumeData", JSON.stringify({
        fields: fields.reduce((acc,f) => ({...acc, [f]: document.getElementById(f).value}),{}),
        photo: document.getElementById("prev-photo").src,
        bodyFont: document.getElementById("bodyFont").value,
        headingFont: document.getElementById("headingFont").value,
        fontSize: document.getElementById("fontSize").value,
        lineSpacing: document.getElementById("lineSpacing").value,
        templateColor: document.getElementById("templateColor").value
      }));
    }

    function loadData() {
      const data = JSON.parse(localStorage.getItem("resumeData"));
      if (!data) return;
      fields.forEach(f => {
        document.getElementById(f).value = data.fields[f] || "";
        document.getElementById("prev-"+f).innerText = data.fields[f] || "";
      });
      document.getElementById("prev-photo").src = data.photo;
      resumeBox.style.fontFamily = data.bodyFont;
      resumeBox.querySelectorAll("h1,h2,h3").forEach(h => h.style.fontFamily = data.headingFont);
      resumeBox.style.fontSize = data.fontSize+"px";
      resumeBox.style.lineHeight = data.lineSpacing;
      resumeBox.querySelectorAll("h1,h2,h3").forEach(h => h.style.color = data.templateColor);
    }
    loadData();

    // Reset Resume
    function resetResume() {
      localStorage.removeItem("resumeData");
      window.location.reload();
    }

    // PDF Download
    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF("p","pt","a4");
      await doc.html(document.getElementById("resume-template"), {
        callback: pdf => pdf.save("resume.pdf"),
        x: 20, y: 20, width: 550
      });
    }

    // DOCX Download
    function downloadDOCX() {
      const text = document.getElementById("resume-template").innerText;
      const blob = new Blob([text], { type: "application/vnd.openxmlformats-officedocument.wordprocessingml.document" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "resume.docx";
      link.click();
    }

    // TXT Download
    function downloadTXT() {
      const text = document.getElementById("resume-template").innerText;
      const blob = new Blob([text], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "resume.txt";
      link.click();
    }
  </script>
</body>
</html>
<script>// At the bottom of builder.html
if (urlParams.get("ai") === "true") {
  const data = JSON.parse(localStorage.getItem("resumeDataAI"));
  if (data && data.resume) {
    document.getElementById("summary").value = data.resume;
    document.getElementById("prev-summary").innerText = data.resume;
  }
}
</script>